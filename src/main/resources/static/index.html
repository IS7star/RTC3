<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/common.css">
	<title>気分選択画面</title>
</head>

<body style="text-align: center;">
	<div>
		<h1>献立提案サービス</h1>
		<div class="tab-wrap">
	    <input id="tab01" type="radio" name="tab" class="tab-switch" checked="checked">
	    <label class="tab-label" for="tab01">感情を入力してみる</label>
	    <div class="tab-content">
			
			<!--感情分析による献立提案-->
			<p>感情分析するよ！なんでも入力してね。</p>	
			<input type="text/css" placeholder="必須：○○な気分"class="form-control control"  id="inputText"maxlength="20" required
			autocomplete="off"/><br>
			<button id="submit1"  onclick="fetchData()" name="my_submit" class="my_submit_btn" value="signup">送信</button>
				

			
			<br><br>
	    </div>	    
	    <input id="tab02" type="radio" name="tab" class="tab-switch"><label class="tab-label" for="tab02">気分で選ぶ</label>
    	<div class="tab-content" id="back">
			
		<!--気分選択による献立提案-->
		<p>気分に合わせた献立をご提案します。</p>
		<table style="border: none; background: none">
			<tr>
				<td>がっつり</td>
				<td>あっさり</td>
				<td>お子様向け</td>
			</tr>
			<tr>
				<td>
					<a href="/SearchReshipi?moodCd=1" class="button" alt="がっつり">
						<span id="buttonImage1"></span></a>
				</td>
				<td>
					<a href="/SearchReshipi?moodCd=2" class="button" alt="あっさり">
						<span id="buttonImage2"></span></a>
				</td>
				<td>
					<a href="/SearchReshipi?moodCd=3" class="button" alt="お子様向け">
						<span id="buttonImage3"></span></a>
				</td>
			</tr>
			<tr>
				<td>おしゃれ</td>
				<td>時短メニュー</td>
				<td>ダイエットメニュー</td>
			</tr>
			<tr>
				<td>
					<a href="/SearchReshipi?moodCd=4" class="button" alt="おしゃれ">
						<span id="buttonImage4"></span></a>
				</td>
				<td>
					<a href="/SearchReshipi?moodCd=5" class="button" alt="時短メニュー">
						<span id="buttonImage5"></span></a>
				</td>
				<td>
					<a href="/SearchReshipi?moodCd=6" class="button" alt="ダイエットメニュー">
						<span id="buttonImage6"></span></a>
				</td>
			</tr>
		</table>
	</div>
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
	<script>
				//必須入力チェック処理
			const inputText = document.getElementById("inputText")
			const button = document.getElementById("submit1")
			button.disabled = true;
			button.classList.add('is-inactive');
			
			inputText.addEventListener("input", update)
			inputText.addEventListener("change", update)
		
			function update() {
			
				const isRequired = inputText.checkValidity()
  				if (isRequired) {
				    button.disabled = false;
				    button.classList.remove('is-inactive');
				    button.classList.add('is-active');
				    return
  				}else {
				    button.disabled = true;
				    button.classList.remove('is-active');
				    button.classList.add('is-inactive');
				}
			}
			function fetchData() {
				var inputText = document.getElementById("inputText").value;
				const data = {
					kind: "SentimentAnalysis",
					parameters: {
						modelVersion: "latest",
						opinionMining: "False"
					},
					analysisInput: {
						documents: [
							{
								id: "1",
								language: "ja",
								text: inputText
							}
						]
					}
				};
				// HTMLのボタン要素にイベントリスナーを追加する
				const button = document.querySelector('button');
				button.addEventListener('click', fetchData);
				
				fetch('https://test20230629abe.cognitiveservices.azure.com/language/:analyze-text?api-version=2023-04-01', {
					method: 'POST',
					headers: {
						'Ocp-Apim-Subscription-Key': 'c60a6b97f8f444d4ae314ae621a08862',
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(data)
				})
					.then(response => response.json())
					.then(data => {
						const valueToPost = data.results.documents[0].sentiment;
	
						const form = document.createElement('form');
						form.action = '/emotionInput'; // POSTリクエストを送信するURL
						form.method = 'POST';
	
						const input = document.createElement('input');
						input.type = 'hidden';
						input.name = 'emotion'; // POSTデータのキー
						input.value = valueToPost; // POSTデータの値
						
						
						form.appendChild(input);
						document.body.appendChild(form);
						form.submit(); // フォームを自動的に送信（submit）する		
					})
					.catch(error => {
						console.log(data);
					});
		}
	</script>
</body>

</html>